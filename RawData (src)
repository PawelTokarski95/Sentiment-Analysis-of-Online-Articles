from newsapi import NewsApiClient
from assets import ASSETS
from datetime import datetime, timedelta

def get_articles(newsapi_key: str, assets=None):
    newsapi = NewsApiClient(api_key=newsapi_key)
    articles = {}

    if assets is None:
        from assets import ASSETS
        assets = ASSETS

    month_ago = datetime.today() - timedelta(days=30)
    today = datetime.today()

    month_ago = month_ago.strftime("%Y-%m-%d")
    today = today.strftime("%Y-%m-%d")

    for asset in assets:
        articles[asset] = newsapi.get_everything(
            q=asset,
            sources="bbc-news,reuters,financial-times,cnbc,the-wall-street-journal,bloomberg,forbes,nasdaq,business-insider",
            from_param=month_ago,
            to=today,
            language="en",
            page_size=100
        )

    return articles
